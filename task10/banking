import json
import os

# File to store account data
DATA_FILE = "bank_data.json"

def load_data():
    """Loads account data from the JSON file."""
    if not os.path.exists(DATA_FILE):
        return {}
    try:
        with open(DATA_FILE, 'r') as file:
            return json.load(file)
    except (json.JSONDecodeError, IOError):
        return {}

def save_data(accounts):
    """Saves the account dictionary to the JSON file."""
    try:
        with open(DATA_FILE, 'w') as file:
            json.dump(accounts, file, indent=4)
    except IOError as e:
        print(f"Error saving data: {e}")

def create_account(accounts):
    """Creates a new bank account."""
    acc_num = input("Enter a unique Account Number: ").strip()
    
    if acc_num in accounts:
        print("Error: Account number already exists.")
        return

    name = input("Enter Customer Name: ").strip()
    try:
        initial_deposit = float(input("Enter Initial Deposit Amount: "))
        if initial_deposit < 0:
            print("Error: Initial deposit cannot be negative.")
            return
    except ValueError:
        print("Error: Invalid amount entered.")
        return

    accounts[acc_num] = {
        "Name": name,
        "Balance": initial_deposit
    }
    save_data(accounts)
    print(f"Account created successfully for {name} with Account #{acc_num}.")

def deposit_money(accounts):
    """Adds funds to an existing account."""
    acc_num = input("Enter Account Number: ").strip()
    
    if acc_num not in accounts:
        print("Error: Account not found.")
        return

    try:
        amount = float(input("Enter Amount to Deposit: "))
        if amount <= 0:
            print("Error: Deposit amount must be positive.")
            return
    except ValueError:
        print("Error: Invalid amount entered.")
        return

    accounts[acc_num]['Balance'] += amount
    save_data(accounts)
    print(f"Deposited ${amount:.2f}. New Balance: ${accounts[acc_num]['Balance']:.2f}")

def withdraw_money(accounts):
    """Deducts funds from an account if sufficient balance exists."""
    acc_num = input("Enter Account Number: ").strip()
    
    if acc_num not in accounts:
        print("Error: Account not found.")
        return

    try:
        amount = float(input("Enter Amount to Withdraw: "))
        if amount <= 0:
            print("Error: Withdrawal amount must be positive.")
            return
    except ValueError:
        print("Error: Invalid amount entered.")
        return

    current_balance = accounts[acc_num]['Balance']
    
    if amount > current_balance:
        print(f"Error: Insufficient funds. Available Balance: ${current_balance:.2f}")
    else:
        accounts[acc_num]['Balance'] -= amount
        save_data(accounts)
        print(f"Withdrawn ${amount:.2f}. New Balance: ${accounts[acc_num]['Balance']:.2f}")

def check_balance(accounts):
    """Displays the current balance of an account."""
    acc_num = input("Enter Account Number: ").strip()
    
    if acc_num not in accounts:
        print("Error: Account not found.")
    else:
        name = accounts[acc_num]['Name']
        balance = accounts[acc_num]['Balance']
        print(f"\nAccount: {acc_num}")
        print(f"Holder: {name}")
        print(f"Current Balance: ${balance:.2f}")

def main():
    """Main program loop."""
    accounts = load_data()
    
    while True:
        print("\n=== Bank Account Management System ===")
        print("1. Create New Account")
        print("2. Deposit Money")
        print("3. Withdraw Money")
        print("4. Check Balance")
        print("5. Exit")
        
        choice = input("Enter your choice (1-5): ").strip()
        
        if choice == '1':
            create_account(accounts)
        elif choice == '2':
            deposit_money(accounts)
        elif choice == '3':
            withdraw_money(accounts)
        elif choice == '4':
            check_balance(accounts)
        elif choice == '5':
            print("Exiting system. Have a nice day!")
            break
        else:
            print("Invalid choice. Please try again.")

if __name__ == "__main__":
    main()